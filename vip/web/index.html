<script>
    let wx_sign = function() {
        if (window.localStorage.state) {
            let arr = window.location.search.slice(1).split('&')
            let o = {}
            for (let e of arr) {
                let a = e.split('=')
                let key = a[0]
                let val = a[1]
                o[key] = val
            }
            if (o.state === window.localStorage.state) {
                // Sea.Ajax({
                //     url: 'http://li-flower.com:8001/wx_api/sign_in',
                //     data: {
                //         code: o.code,
                //     }
                // }).then(res => {
                //     let data = JSON.parse(res)
                // })
            } else {
                let data = {"access_token":"4_yuFgp8DjGhLLggojJe5OIogHgtq6EKRUXjj68-8AwWECJ2vEB3U7xQR3pmkV0KucF2JLbxoIzP-kTz84EE2sHg","expires_in":7200,"refresh_token":"4__fttW_iohLeEaHKNCptJBQG19dibQe02nd_fKc7oOZPgnX1H_v3LGhS8KGeV9Mclx5pYD0qsXvdMNaBXdy92dg","openid":"oeAUq1SEowuGLUciXOP3cu3pBPyY","scope":"snsapi_login","unionid":"o-S7Z0hD3RZ7Xphthy3GiUSSLHdI"}
                Sea.Ajax({
                    method: 'get',
                    url: 'http://li-flower.com:8001/wx_api/userinfo',
                    data: {
                        access_token: data.access_token,
                        openid: data.openid,
                    }
                }).then(res => {
                    log(res)
                })
                // alert('state 错误')
                // window.location = '/sign-in'
            }
        } else {
            alert('error 请登录')
            window.location = '/sign-in'
        }
    }
    if (window.localStorage.u) {
        let u = JSON.parse(window.localStorage.u)
        Sea.Ajax({
            url: 'http://li-flower.com:8001/infocenter',
            // url: '/user_login',
            data: u,
        }).then(res => {
            let data = JSON.parse(res)
            if (data.ok) {
                let o = data.data
                $('#u-phone').text(o.phone)

                $('#u-name').val(o.name || '')

                $('#loc_province').select2('data').text = o.province
                $('#select2-chosen-1').text(o.province)
                $('#loc_city').select2('data').text = o.city
                $('#select2-chosen-2').text(o.city)
                $('#loc_town').select2('data').text = o.town
                $('#select2-chosen-3').text(o.town)

                $('.sign-sex btn').each(function(i, e) {
                    if (e.innerText == o.sex) {
                        this.style.background = '#141414'
                        this.style.color = 'white'
                    } else {
                        this.style = ''
                    }
                })
            } else {
                wx_sign()
            }
        })
    } else {
        wx_sign()
    }
</script>
